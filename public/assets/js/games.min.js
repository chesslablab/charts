const script=document.getElementById("theScript"),scheme=script.getAttribute("data-scheme"),host=script.getAttribute("data-host"),port=script.getAttribute("data-port"),gameForm=document.getElementById("gameForm"),tutor=document.getElementById("tutor"),charts=document.getElementById("charts"),allEqual=e=>e.every(t=>t===e[0]);gameForm.querySelector("button").onclick=e=>{for(e.preventDefault();tutor.firstChild;)tutor.removeChild(tutor.firstChild);for(;charts.firstChild;)charts.removeChild(charts.firstChild);document.getElementById("validation").style.display="none",document.getElementById("board").style.display="none",document.getElementById("tutor").style.display="none",document.getElementById("downloadBtn").style.display="none",document.getElementById("spinner").style.display="block";let t=fetch(`${scheme}://${host}:${port}/api/heuristics`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({movetext:gameForm.querySelector("textarea").value})}).then(e=>e.json()).then(e=>{e.evalNames.forEach((t,a)=>{let l=e.balance.map((e,t)=>e[a]);if(!allEqual(l)){let o=document.createElement("div"),i=document.createElement("canvas");o.appendChild(i),charts.appendChild(o),new Chart(i,{type:"line",data:{labels:l,datasets:[{label:t,data:l,borderWidth:2.25,tension:.25,borderColor:"#0a0a0a"}]},options:{animation:!1,elements:{point:{radius:0}},scales:{y:{ticks:{display:!1},grid:{display:!1},border:{display:!1},beginAtZero:!0,min:-1.1,max:1.1},x:{ticks:{display:!1},grid:{display:!1},border:{display:!1}}},plugins:{legend:{position:"bottom",labels:{boxWidth:0,font:{size:16}}}}}})}})}),a=fetch(`${scheme}://${host}:${port}/api/tutor/fen`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({movetext:gameForm.querySelector("textarea").value})}).then(e=>e.json()).then(e=>{if(e.movetext){PGNV.pgnView("board",{pgn:e.movetext,locale:"en",pieceStyle:"wikipedia",resizable:!1,startPlay:e.movetext.split(" ").length,showFen:!0});let t=document.createElement("p");t.appendChild(document.createTextNode(`Here is a description of this position. ${e.paragraph}`)),tutor.appendChild(t)}});Promise.all([t,a]).then(()=>{document.getElementById("board").style.display="block",document.getElementById("tutor").style.display="block",document.getElementById("downloadBtn").style.display="block"}).catch(e=>{document.getElementById("validation").style.display="block"}).finally(()=>{document.getElementById("spinner").style.display="none"})},document.getElementById("downloadBtn").onclick=e=>{e.preventDefault(),html2canvas(document.getElementById("charts")).then(e=>{let t=document.createElement("a");t.href=e.toDataURL("image/jpeg"),t.download="chessvisual.jpeg",t.click()})};
